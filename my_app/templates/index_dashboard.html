{% extends 'layouts/base.html' %}
{% load static %}
{% load i18n %}


{% block title %}{% trans "Manager Dashboard" %}{% endblock %}

{% block stylesheets %} {% endblock stylesheets %}

{% block content %}
            {% block page_name %} {% trans "Dashboard" %} {% endblock %}
<!-- comtent -->

<div class="row justify-content-center" style="margin-top: 150px;">
        <div class="d-flex justify-content-between align-items-center">
            <a href="{% url 'product_create' %}" class="btn btn-success">{% trans "Define Book's" %}
                <i class="fas fa-download"></i>
            </a>
        </div>
        <!-- Dashboard card 1 - Sales Orders -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">  
        <a class="nav-link" href="/sales">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"> <strong>{% trans "Sales Orders" %}</strong></span>
                                    {{sales_orders_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                            <i class="ni ni-calendar-grid-58 text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 2 - Return Sales -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/return_sales">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Return Sales" %}</strong></span>
                                    {{return_sales_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                            <i class="ni ni-basket text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 3 - Purchase Invoices -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/purchases">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Purchase Invoices" %}</strong></span>
                                    {{purchases_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                            <i class="ni ni-credit-card text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 4 - Return Purchases -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/return_purchases">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Return Purchases" %}</strong></span>
                                    {{return_purchases_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                            <i class="ni ni-tag text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>
    </div>

    <div class="row mt-4">
      <!-- Dashboard card 5 - Stock Out Voucher -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/stock_out_voucher">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Stock Out Voucher" %}</strong></span>
                                    {{stock_out_vouchers_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                            <i class="ni ni-delivery-fast text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 6 - Product List -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/products">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Product List" %}</strong></span>
                                    {{products_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                            <i class="ni ni-app text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 7 - Suppliers -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/suppliers">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Suppliers" %}</strong></span>
                                    {{suppliers_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                            <i class="ni ni-badge text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>

      <!-- Dashboard card 8 - Customers -->
      <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
        <a class="nav-link" href="/customers">
            <div class="card bg-gradient-secondary shadow-primary border-radius-xl">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="mb-0">
                                    <span class="nav-link-text ms-1 " style="font-size:25px !important; color: #fff;"><strong>{% trans "Customers" %}</strong></span>
                                    {{customers_count}}
                                </p>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                            <i class="ni ni-badge text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
      </div>
    </div>
    




    </div>
<!-- end comtent -->
{% endblock content %}
<!-- Specific Page JS goes HERE  -->
{% block javascripts %} 

  <script>
    var ctx1 = document.getElementById("chart-line").getContext("2d");
    var today_sales = "{{today_sale_order}}";
    var saturday = "{{saturday}}";
    var sunday =  "{{sunday}}";
    var monday =  "{{monday}}";
    var tuseday =  "{{tuseday}}";

    var wednesday =  "{{wednesday}}";
    var thurseday =  "{{thurseday}}";
    var friday =  "{{friday}}";

    var gradientStroke1 = ctx1.createLinearGradient(0, 230, 0, 50);

    gradientStroke1.addColorStop(1, 'rgba(94, 114, 228, 0.2)');
    gradientStroke1.addColorStop(0.2, 'rgba(94, 114, 228, 0.0)');
    gradientStroke1.addColorStop(0, 'rgba(94, 114, 228, 0)');
    new Chart(ctx1, {
      type: "line",
      data: {
        labels: ["Saturday","Sunday","Monday","Tuseday","Wednesday","Thurseday","Friday"],
        datasets: [{
          label: "No. of sale orders",
          tension: 0.4,
          borderWidth: 0,
          pointRadius: 0,
          borderColor: "#5e72e4",
          backgroundColor: gradientStroke1,
          borderWidth: 3,
          fill: true,
          data: [saturday , sunday  ,monday,tuseday,wednesday ,thurseday ,friday],
          maxBarThickness: 6

        }],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          }
        },
        interaction: {
          intersect: false,
          mode: 'index',
        },
        scales: {
          y: {
            grid: {
              drawBorder: false,
              display: true,
              drawOnChartArea: true,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              padding: 10,
              color: '#fbfbfb',
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
          x: {
            grid: {
              drawBorder: false,
              display: false,
              drawOnChartArea: false,
              drawTicks: false,
              borderDash: [5, 5]
            },
            ticks: {
              display: true,
              color: '#ccc',
              padding: 20,
              font: {
                size: 11,
                family: "Open Sans",
                style: 'normal',
                lineHeight: 2
              },
            }
          },
        },
      },
    });
  </script>


<script>
function updateActiveUsers() {
    // AJAX call to fetch active users
    $.ajax({
        url: 'get_active_users/',
        method: 'GET',
        success: function(response) {
        // Render active users in the div
        $('#activeUsers').empty();
        response.active_users.forEach(function(employee) {
            $('#activeUsers').append('<p  style="width: max-content;" class="message_success">' + employee.first_name +' '+ employee.last_name + '</p>');
        });
        },
        error: function(err) {
        console.error('Error fetching active users:', err);
        }
    });
    }
    
    // Update active users every 30 seconds
  setInterval(updateActiveUsers, 15000); //1000 means 1 second
</script>


{% endblock javascripts %}

