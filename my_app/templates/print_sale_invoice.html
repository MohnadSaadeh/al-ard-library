
{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% comment %} <!doctype html> {% endcomment %}
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% trans "Sales Invoice" %} #{{ order.id }}</title>
    <link rel="stylesheet" href="/static/css/argon-dashboard.min.css" />
    <style>
      body{ font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; color:#212529; padding:20px; }
      .container{ max-width:900px; margin:0 auto; }
      .text-center{ text-align:center; }
      .text-end{ text-align:right; }
      .invoice-box{ border:1px solid #dee2e6; border-radius:6px; background:#fff; }
      .invoice-header{ border-bottom:1px solid #dee2e6; padding:12px; }
      .invoice-footer{ border-top:1px solid #dee2e6; padding:12px; }
      .table{ width:100%; border-collapse:collapse; border:1px solid #dee2e6; border-spacing:0; }
      .table th, .table td, table th, table td{ border:1px solid #dee2e6 !important; padding:.2rem; word-break: break-word; }
      .table tbody tr:last-child td{ border-bottom:1px solid #dee2e6 !important; }
      .table tbody tr:only-child td{ border-top:1px solid #dee2e6 !important; border-bottom:1px solid #dee2e6 !important; }
      .table tfoot td{ border-top:2px solid #dee2e6; }
      .small{ font-size:0.9rem; color:#6c757d; }
      /* RTL adjustments */
      [dir="rtl"] body { direction: rtl; text-align: right; }
      [dir="rtl"] .text-end { text-align: left; }
      [dir="rtl"] .d-flex { flex-direction: row-reverse; }
      /* Print-specific adjustments for portrait layout */
      @page { size: A4 portrait; margin: 4mm; }
      @media print{
        body{ margin:0; }
        .container{ max-width:100%; padding:0; }
        .invoice-box{ border:none; border-radius:0; }
        .invoice-header, .invoice-footer{ padding:8px; }
        img{ max-width:100%; height:auto; }
        .table{ font-size:12px; }
        .table th, .table td{ padding:4px; }
        thead{ display: table-header-group; }
        tfoot{ display: table-footer-group; }
        tr{ page-break-inside: avoid; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="invoice-box p-4">
        <div class="text-center mb-3 invoice-header">
          <img src="{% static 'img/al-ard-profile-Banner.png' %}" alt="Al Ard" style="max-height:120px; display:block; margin:0 auto;" />
        </div>

        <h2 class="text-center">{% trans "Sales Invoice" %}</h2>
        {% if order.customer %}
          <div class="small text-muted text-center">{% trans "Customer" %} : <strong><a href="/customers/{{ order.customer.id }}/">{{ order.customer.name }}</a></strong></div>
        {% endif %}
        <div class="text-center small text-muted mb-2">
          {% trans "Invoice No:" %} <strong>#{{ order.id }}</strong> &nbsp; | &nbsp; {% trans "Date:" %} <strong>{{ order.created_at|date:'Y-m-d H:i' }}</strong> {% if order.currency %}&nbsp; | &nbsp; {% trans "Currency:" %} <strong>{{ order.currency.code }}</strong>{% endif %}
        </div>
        <div class="text-center small text-muted mb-2">
          {% if company %}
            <strong>{{ company.company_name }}</strong>
            {% if company.address %} &nbsp; | &nbsp; {{ company.address }}{% endif %}
            {% if company.registration_number %} &nbsp; | &nbsp; {{ _('Reg. No:') }} {{ company.registration_number }}{% endif %}
          {% endif %}
        </div>

        <div class="table-responsive">
          <table class="table table-sm-responsive table-bordered">
          <thead class="table-light">
            <tr>
              <th> {% trans "No." %} </th>
              <th> {% trans "ISBN" %} </th>
              <th>{% trans "Product" %}</th>
              <th>{% trans "Quantity" %}</th>
              <th>{% trans "Unit Price" %}</th>
              <th>{% trans "Total Price" %}</th>
              <!-- if the order currency is different from the base currency, show the converted total base -->
                {% if order.currency and order.exchange_rate_to_base != 1 %}
                    <th>{% trans "Total (Base)" %}</th>
                {% endif %}
            </tr>
          </thead>
          <tbody>
            {% if sale_products %}
              {% for item in sale_products %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.product.isbn }}</td>
                <td>{{ item.product.product_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unit_price }}</td>
                <td>{{ item.total_price }}</td>
              <!-- if the order currency is different from the base currency, show the converted total price -->
                {% if order.currency and order.exchange_rate_to_base != 1 %}
                    <td>{{ item.total_price_base }} {{ order.currency.code }}</td>
                {% endif %}
            </tr>
              {% endfor %}
             <tr class="table-secondary fw-bold">
                <td colspan="5" class="text-end">{% trans "Grand Total" %}</td>
                <td>{{ order.grand_total }} {{company.base_currency.code}}</td>
                  <!-- if the order currency is different from the base currency, show the converted total -->
                  {% if order.currency and order.exchange_rate_to_base != 1 %}
                      <td>{{ order.total_amount_base }} {{ order.currency.code }}</td>
                  {% endif %}
              </tr>
            {% endif %}
          </tbody>
          
        </table>
      </div>

        <div class="mt-4 d-flex justify-content-between invoice-footer">
          <div class="small text-muted">
            {% if company and company.registration_number %}<div><strong>{% trans "VAT / Tax No:" %}</strong>  {{ company.registration_number }}</div>{% endif %}
            <div><strong>{% trans "Payment Terms:" %}</strong> {{ order.invoice_pay_method|title }}</div>
            {% if order.currency %}<div><strong>{% trans "Currency:" %}</strong> {{ order.currency.code }}</div>{% endif %}
          </div>
          <div style="min-width:300px; text-align:right;">
            <div style="margin-bottom:40px;">_____________________________<br/>{% trans "Authorized Signature" %}</div>
            <div>_____________________________<br/>{% trans "Received by (Supplier)" %}</div>
          </div>
        </div>
      </div>
    </div>

    <script>window.onload = function(){ window.print(); };</script>
  </body>
</html>
